//This kernel runs vvadd2x2 on a 2x2 CGRA accelerator

#include "bsg_manycore.h"
#include "bsg_set_tile_x_y.h"
#include "bsg_mutex.h"

// TODO: is there a way to malloc in the scratchpad?
#define MAX_ARRAY_SIZE   64
#define CFG_IMAGE_START  16
#define CFG_IMAGE_END    512
#define OP_A_START       0x800
#define OP_B_START       0x900
#define RES_C_START      0xA00

#define BASE_CFG_ADDR_ID 2
#define BASE_CFG_ADDR    0x040
#define GO_CFG_ID        0
#define DONE_ID          4

#define XCEL_X_CORD      0
#define XCEL_Y_CORD      (bsg_global_Y-1)

// Only one tile is used to drive the accelerator and no synchronization is needed
/* #define BSG_TILE_GROUP_X_DIM bsg_tiles_X */
/* #define BSG_TILE_GROUP_Y_DIM bsg_tiles_Y */
/* #include "bsg_tile_group_barrier.h" */
/* INIT_TILE_GROUP_BARRIER(r_barrier, c_barrier, 0, bsg_tiles_X-1, 0, bsg_tiles_Y-1); */

int scratchpad_A[MAX_ARRAY_SIZE];
int scratchpad_B[MAX_ARRAY_SIZE];
int scratchpad_C[MAX_ARRAY_SIZE];

unsigned int vvadd2x2_cfg[CFG_IMAGE_END] = {
//********** BEGIN CGRA MEM IMAGE DUMP **********
//===============================================
// CGRAXcel Scratchpad Cfg Memory Image
// Size: 2048B
// Range: 0x00000000 ~ 0x000007ff
//===============================================

//-----------------------------------------------
// Empty CSR Region
// Size: 64B
// Range: 0x00000000 ~ 0x0000003f
//-----------------------------------------------
/* 0x00000000 */ 0x00000000,
/* 0x00000004 */ 0x00000000,
/* 0x00000008 */ 0x00000000,
/* 0x0000000c */ 0x00000000,
/* 0x00000010 */ 0x00000000,
/* 0x00000014 */ 0x00000000,
/* 0x00000018 */ 0x00000000,
/* 0x0000001c */ 0x00000000,
/* 0x00000020 */ 0x00000000,
/* 0x00000024 */ 0x00000000,
/* 0x00000028 */ 0x00000000,
/* 0x0000002c */ 0x00000000,
/* 0x00000030 */ 0x00000000,
/* 0x00000034 */ 0x00000000,
/* 0x00000038 */ 0x00000000,
/* 0x0000003c */ 0x00000000,

//-----------------------------------------------
// Configuration Region
// Size: 1984B
// Range: 0x00000040 ~ 0x000007ff
//-----------------------------------------------
/* 0x00000040 */ 0x00008080,
/* 0x00000044 */ 0x00000010,
/* 0x00000048 */ 0x00008081,
/* 0x0000004c */ 0x00000012,
/* 0x00000050 */ 0xc0400000,
/* 0x00000054 */ 0x000000c0,
/* 0x00000058 */ 0xc0400001,
/* 0x0000005c */ 0x000000c0,
/* 0x00000060 */ 0x40400000,
/* 0x00000064 */ 0x000000c4,
/* 0x00000068 */ 0xc0400001,
/* 0x0000006c */ 0x00000910,
/* 0x00000070 */ 0x00000000,
/* 0x00000074 */ 0x00000000,
/* 0x00000078 */ 0x00008081,
/* 0x0000007c */ 0x00000034,
/* 0x00000080 */ 0x00000000,
/* 0x00000084 */ 0x00000000,
/* 0x00000088 */ 0x00000000,
/* 0x0000008c */ 0x00000000,
/* 0x00000090 */ 0x00000000,
/* 0x00000094 */ 0x00000000,
/* 0x00000098 */ 0x00000000,
/* 0x0000009c */ 0x00000000,
/* 0x000000a0 */ 0x00000000,
/* 0x000000a4 */ 0x00000000,
/* 0x000000a8 */ 0x00000000,
/* 0x000000ac */ 0x00000000,
/* 0x000000b0 */ 0x00000000,
/* 0x000000b4 */ 0x00000000,
/* 0x000000b8 */ 0x00000000,
/* 0x000000bc */ 0x00000000,
/* 0x000000c0 */ 0x00000000,
/* 0x000000c4 */ 0x00000000,
/* 0x000000c8 */ 0x00000000,
/* 0x000000cc */ 0x00000000,
/* 0x000000d0 */ 0x00000000,
/* 0x000000d4 */ 0x00000000,
/* 0x000000d8 */ 0x00000000,
/* 0x000000dc */ 0x00000000,
/* 0x000000e0 */ 0x00000000,
/* 0x000000e4 */ 0x00000000,
/* 0x000000e8 */ 0x00000000,
/* 0x000000ec */ 0x00000000,
/* 0x000000f0 */ 0x00000000,
/* 0x000000f4 */ 0x00000000,
/* 0x000000f8 */ 0x00000000,
/* 0x000000fc */ 0x00000000,
/* 0x00000100 */ 0x00000000,
/* 0x00000104 */ 0x00000000,
/* 0x00000108 */ 0x00000000,
/* 0x0000010c */ 0x00000000,
/* 0x00000110 */ 0x00000000,
/* 0x00000114 */ 0x00000000,
/* 0x00000118 */ 0x00000000,
/* 0x0000011c */ 0x00000000,
/* 0x00000120 */ 0x00000000,
/* 0x00000124 */ 0x00000000,
/* 0x00000128 */ 0x00000000,
/* 0x0000012c */ 0x00000000,
/* 0x00000130 */ 0x00000000,
/* 0x00000134 */ 0x00000000,
/* 0x00000138 */ 0x00000000,
/* 0x0000013c */ 0x00000000,
/* 0x00000140 */ 0x00000000,
/* 0x00000144 */ 0x00000000,
/* 0x00000148 */ 0x00000000,
/* 0x0000014c */ 0x00000000,
/* 0x00000150 */ 0x00000000,
/* 0x00000154 */ 0x00000000,
/* 0x00000158 */ 0x00000000,
/* 0x0000015c */ 0x00000000,
/* 0x00000160 */ 0x00000000,
/* 0x00000164 */ 0x00000000,
/* 0x00000168 */ 0x00000000,
/* 0x0000016c */ 0x00000000,
/* 0x00000170 */ 0x00000000,
/* 0x00000174 */ 0x00000000,
/* 0x00000178 */ 0x00000000,
/* 0x0000017c */ 0x00000000,
/* 0x00000180 */ 0x00000000,
/* 0x00000184 */ 0x00000000,
/* 0x00000188 */ 0x00000000,
/* 0x0000018c */ 0x00000000,
/* 0x00000190 */ 0x00000000,
/* 0x00000194 */ 0x00000000,
/* 0x00000198 */ 0x00000000,
/* 0x0000019c */ 0x00000000,
/* 0x000001a0 */ 0x00000000,
/* 0x000001a4 */ 0x00000000,
/* 0x000001a8 */ 0x00000000,
/* 0x000001ac */ 0x00000000,
/* 0x000001b0 */ 0x00000000,
/* 0x000001b4 */ 0x00000000,
/* 0x000001b8 */ 0x00000000,
/* 0x000001bc */ 0x00000000,
/* 0x000001c0 */ 0x00000000,
/* 0x000001c4 */ 0x00000000,
/* 0x000001c8 */ 0x00000000,
/* 0x000001cc */ 0x00000000,
/* 0x000001d0 */ 0x00000000,
/* 0x000001d4 */ 0x00000000,
/* 0x000001d8 */ 0x00000000,
/* 0x000001dc */ 0x00000000,
/* 0x000001e0 */ 0x00000000,
/* 0x000001e4 */ 0x00000000,
/* 0x000001e8 */ 0x00000000,
/* 0x000001ec */ 0x00000000,
/* 0x000001f0 */ 0x00000000,
/* 0x000001f4 */ 0x00000000,
/* 0x000001f8 */ 0x00000000,
/* 0x000001fc */ 0x00000000,
/* 0x00000200 */ 0x00000000,
/* 0x00000204 */ 0x00000000,
/* 0x00000208 */ 0x00000000,
/* 0x0000020c */ 0x00000000,
/* 0x00000210 */ 0x00000000,
/* 0x00000214 */ 0x00000000,
/* 0x00000218 */ 0x00000000,
/* 0x0000021c */ 0x00000000,
/* 0x00000220 */ 0x00000000,
/* 0x00000224 */ 0x00000000,
/* 0x00000228 */ 0x00000000,
/* 0x0000022c */ 0x00000000,
/* 0x00000230 */ 0x00000000,
/* 0x00000234 */ 0x00000000,
/* 0x00000238 */ 0x00000000,
/* 0x0000023c */ 0x00000000,
/* 0x00000240 */ 0x00000000,
/* 0x00000244 */ 0x00000000,
/* 0x00000248 */ 0x00000000,
/* 0x0000024c */ 0x00000000,
/* 0x00000250 */ 0x00000000,
/* 0x00000254 */ 0x00000000,
/* 0x00000258 */ 0x00000000,
/* 0x0000025c */ 0x00000000,
/* 0x00000260 */ 0x00000000,
/* 0x00000264 */ 0x00000000,
/* 0x00000268 */ 0x00000000,
/* 0x0000026c */ 0x00000000,
/* 0x00000270 */ 0x00000000,
/* 0x00000274 */ 0x00000000,
/* 0x00000278 */ 0x00000000,
/* 0x0000027c */ 0x00000000,
/* 0x00000280 */ 0x00000000,
/* 0x00000284 */ 0x00000000,
/* 0x00000288 */ 0x00000000,
/* 0x0000028c */ 0x00000000,
/* 0x00000290 */ 0x00000000,
/* 0x00000294 */ 0x00000000,
/* 0x00000298 */ 0x00000000,
/* 0x0000029c */ 0x00000000,
/* 0x000002a0 */ 0x00000000,
/* 0x000002a4 */ 0x00000000,
/* 0x000002a8 */ 0x00000000,
/* 0x000002ac */ 0x00000000,
/* 0x000002b0 */ 0x00000000,
/* 0x000002b4 */ 0x00000000,
/* 0x000002b8 */ 0x00000000,
/* 0x000002bc */ 0x00000000,
/* 0x000002c0 */ 0x00000000,
/* 0x000002c4 */ 0x00000000,
/* 0x000002c8 */ 0x00000000,
/* 0x000002cc */ 0x00000000,
/* 0x000002d0 */ 0x00000000,
/* 0x000002d4 */ 0x00000000,
/* 0x000002d8 */ 0x00000000,
/* 0x000002dc */ 0x00000000,
/* 0x000002e0 */ 0x00000000,
/* 0x000002e4 */ 0x00000000,
/* 0x000002e8 */ 0x00000000,
/* 0x000002ec */ 0x00000000,
/* 0x000002f0 */ 0x00000000,
/* 0x000002f4 */ 0x00000000,
/* 0x000002f8 */ 0x00000000,
/* 0x000002fc */ 0x00000000,
/* 0x00000300 */ 0x00000000,
/* 0x00000304 */ 0x00000000,
/* 0x00000308 */ 0x00000000,
/* 0x0000030c */ 0x00000000,
/* 0x00000310 */ 0x00000000,
/* 0x00000314 */ 0x00000000,
/* 0x00000318 */ 0x00000000,
/* 0x0000031c */ 0x00000000,
/* 0x00000320 */ 0x00000000,
/* 0x00000324 */ 0x00000000,
/* 0x00000328 */ 0x00000000,
/* 0x0000032c */ 0x00000000,
/* 0x00000330 */ 0x00000000,
/* 0x00000334 */ 0x00000000,
/* 0x00000338 */ 0x00000000,
/* 0x0000033c */ 0x00000000,
/* 0x00000340 */ 0x00000000,
/* 0x00000344 */ 0x00000000,
/* 0x00000348 */ 0x00000000,
/* 0x0000034c */ 0x00000000,
/* 0x00000350 */ 0x00000000,
/* 0x00000354 */ 0x00000000,
/* 0x00000358 */ 0x00000000,
/* 0x0000035c */ 0x00000000,
/* 0x00000360 */ 0x00000000,
/* 0x00000364 */ 0x00000000,
/* 0x00000368 */ 0x00000000,
/* 0x0000036c */ 0x00000000,
/* 0x00000370 */ 0x00000000,
/* 0x00000374 */ 0x00000000,
/* 0x00000378 */ 0x00000000,
/* 0x0000037c */ 0x00000000,
/* 0x00000380 */ 0x00000000,
/* 0x00000384 */ 0x00000000,
/* 0x00000388 */ 0x00000000,
/* 0x0000038c */ 0x00000000,
/* 0x00000390 */ 0x00000000,
/* 0x00000394 */ 0x00000000,
/* 0x00000398 */ 0x00000000,
/* 0x0000039c */ 0x00000000,
/* 0x000003a0 */ 0x00000000,
/* 0x000003a4 */ 0x00000000,
/* 0x000003a8 */ 0x00000000,
/* 0x000003ac */ 0x00000000,
/* 0x000003b0 */ 0x00000000,
/* 0x000003b4 */ 0x00000000,
/* 0x000003b8 */ 0x00000000,
/* 0x000003bc */ 0x00000000,
/* 0x000003c0 */ 0x00000000,
/* 0x000003c4 */ 0x00000000,
/* 0x000003c8 */ 0x00000000,
/* 0x000003cc */ 0x00000000,
/* 0x000003d0 */ 0x00000000,
/* 0x000003d4 */ 0x00000000,
/* 0x000003d8 */ 0x00000000,
/* 0x000003dc */ 0x00000000,
/* 0x000003e0 */ 0x00000000,
/* 0x000003e4 */ 0x00000000,
/* 0x000003e8 */ 0x00000000,
/* 0x000003ec */ 0x00000000,
/* 0x000003f0 */ 0x00000000,
/* 0x000003f4 */ 0x00000000,
/* 0x000003f8 */ 0x00000000,
/* 0x000003fc */ 0x00000000,
/* 0x00000400 */ 0x00000000,
/* 0x00000404 */ 0x00000000,
/* 0x00000408 */ 0x00000000,
/* 0x0000040c */ 0x00000000,
/* 0x00000410 */ 0x00000000,
/* 0x00000414 */ 0x00000000,
/* 0x00000418 */ 0x00000000,
/* 0x0000041c */ 0x00000000,
/* 0x00000420 */ 0x00000000,
/* 0x00000424 */ 0x00000000,
/* 0x00000428 */ 0x00000000,
/* 0x0000042c */ 0x00000000,
/* 0x00000430 */ 0x00000000,
/* 0x00000434 */ 0x00000000,
/* 0x00000438 */ 0x00000000,
/* 0x0000043c */ 0x00000000,
/* 0x00000440 */ 0x00000000,
/* 0x00000444 */ 0x00000000,
/* 0x00000448 */ 0x00000000,
/* 0x0000044c */ 0x00000000,
/* 0x00000450 */ 0x00000000,
/* 0x00000454 */ 0x00000000,
/* 0x00000458 */ 0x00000000,
/* 0x0000045c */ 0x00000000,
/* 0x00000460 */ 0x00000000,
/* 0x00000464 */ 0x00000000,
/* 0x00000468 */ 0x00000000,
/* 0x0000046c */ 0x00000000,
/* 0x00000470 */ 0x00000000,
/* 0x00000474 */ 0x00000000,
/* 0x00000478 */ 0x00000000,
/* 0x0000047c */ 0x00000000,
/* 0x00000480 */ 0x00000000,
/* 0x00000484 */ 0x00000000,
/* 0x00000488 */ 0x00000000,
/* 0x0000048c */ 0x00000000,
/* 0x00000490 */ 0x00000000,
/* 0x00000494 */ 0x00000000,
/* 0x00000498 */ 0x00000000,
/* 0x0000049c */ 0x00000000,
/* 0x000004a0 */ 0x00000000,
/* 0x000004a4 */ 0x00000000,
/* 0x000004a8 */ 0x00000000,
/* 0x000004ac */ 0x00000000,
/* 0x000004b0 */ 0x00000000,
/* 0x000004b4 */ 0x00000000,
/* 0x000004b8 */ 0x00000000,
/* 0x000004bc */ 0x00000000,
/* 0x000004c0 */ 0x00000000,
/* 0x000004c4 */ 0x00000000,
/* 0x000004c8 */ 0x00000000,
/* 0x000004cc */ 0x00000000,
/* 0x000004d0 */ 0x00000000,
/* 0x000004d4 */ 0x00000000,
/* 0x000004d8 */ 0x00000000,
/* 0x000004dc */ 0x00000000,
/* 0x000004e0 */ 0x00000000,
/* 0x000004e4 */ 0x00000000,
/* 0x000004e8 */ 0x00000000,
/* 0x000004ec */ 0x00000000,
/* 0x000004f0 */ 0x00000000,
/* 0x000004f4 */ 0x00000000,
/* 0x000004f8 */ 0x00000000,
/* 0x000004fc */ 0x00000000,
/* 0x00000500 */ 0x00000000,
/* 0x00000504 */ 0x00000000,
/* 0x00000508 */ 0x00000000,
/* 0x0000050c */ 0x00000000,
/* 0x00000510 */ 0x00000000,
/* 0x00000514 */ 0x00000000,
/* 0x00000518 */ 0x00000000,
/* 0x0000051c */ 0x00000000,
/* 0x00000520 */ 0x00000000,
/* 0x00000524 */ 0x00000000,
/* 0x00000528 */ 0x00000000,
/* 0x0000052c */ 0x00000000,
/* 0x00000530 */ 0x00000000,
/* 0x00000534 */ 0x00000000,
/* 0x00000538 */ 0x00000000,
/* 0x0000053c */ 0x00000000,
/* 0x00000540 */ 0x00000000,
/* 0x00000544 */ 0x00000000,
/* 0x00000548 */ 0x00000000,
/* 0x0000054c */ 0x00000000,
/* 0x00000550 */ 0x00000000,
/* 0x00000554 */ 0x00000000,
/* 0x00000558 */ 0x00000000,
/* 0x0000055c */ 0x00000000,
/* 0x00000560 */ 0x00000000,
/* 0x00000564 */ 0x00000000,
/* 0x00000568 */ 0x00000000,
/* 0x0000056c */ 0x00000000,
/* 0x00000570 */ 0x00000000,
/* 0x00000574 */ 0x00000000,
/* 0x00000578 */ 0x00000000,
/* 0x0000057c */ 0x00000000,
/* 0x00000580 */ 0x00000000,
/* 0x00000584 */ 0x00000000,
/* 0x00000588 */ 0x00000000,
/* 0x0000058c */ 0x00000000,
/* 0x00000590 */ 0x00000000,
/* 0x00000594 */ 0x00000000,
/* 0x00000598 */ 0x00000000,
/* 0x0000059c */ 0x00000000,
/* 0x000005a0 */ 0x00000000,
/* 0x000005a4 */ 0x00000000,
/* 0x000005a8 */ 0x00000000,
/* 0x000005ac */ 0x00000000,
/* 0x000005b0 */ 0x00000000,
/* 0x000005b4 */ 0x00000000,
/* 0x000005b8 */ 0x00000000,
/* 0x000005bc */ 0x00000000,
/* 0x000005c0 */ 0x00000000,
/* 0x000005c4 */ 0x00000000,
/* 0x000005c8 */ 0x00000000,
/* 0x000005cc */ 0x00000000,
/* 0x000005d0 */ 0x00000000,
/* 0x000005d4 */ 0x00000000,
/* 0x000005d8 */ 0x00000000,
/* 0x000005dc */ 0x00000000,
/* 0x000005e0 */ 0x00000000,
/* 0x000005e4 */ 0x00000000,
/* 0x000005e8 */ 0x00000000,
/* 0x000005ec */ 0x00000000,
/* 0x000005f0 */ 0x00000000,
/* 0x000005f4 */ 0x00000000,
/* 0x000005f8 */ 0x00000000,
/* 0x000005fc */ 0x00000000,
/* 0x00000600 */ 0x00000000,
/* 0x00000604 */ 0x00000000,
/* 0x00000608 */ 0x00000000,
/* 0x0000060c */ 0x00000000,
/* 0x00000610 */ 0x00000000,
/* 0x00000614 */ 0x00000000,
/* 0x00000618 */ 0x00000000,
/* 0x0000061c */ 0x00000000,
/* 0x00000620 */ 0x00000000,
/* 0x00000624 */ 0x00000000,
/* 0x00000628 */ 0x00000000,
/* 0x0000062c */ 0x00000000,
/* 0x00000630 */ 0x00000000,
/* 0x00000634 */ 0x00000000,
/* 0x00000638 */ 0x00000000,
/* 0x0000063c */ 0x00000000,
/* 0x00000640 */ 0x00000000,
/* 0x00000644 */ 0x00000000,
/* 0x00000648 */ 0x00000000,
/* 0x0000064c */ 0x00000000,
/* 0x00000650 */ 0x00000000,
/* 0x00000654 */ 0x00000000,
/* 0x00000658 */ 0x00000000,
/* 0x0000065c */ 0x00000000,
/* 0x00000660 */ 0x00000000,
/* 0x00000664 */ 0x00000000,
/* 0x00000668 */ 0x00000000,
/* 0x0000066c */ 0x00000000,
/* 0x00000670 */ 0x00000000,
/* 0x00000674 */ 0x00000000,
/* 0x00000678 */ 0x00000000,
/* 0x0000067c */ 0x00000000,
/* 0x00000680 */ 0x00000000,
/* 0x00000684 */ 0x00000000,
/* 0x00000688 */ 0x00000000,
/* 0x0000068c */ 0x00000000,
/* 0x00000690 */ 0x00000000,
/* 0x00000694 */ 0x00000000,
/* 0x00000698 */ 0x00000000,
/* 0x0000069c */ 0x00000000,
/* 0x000006a0 */ 0x00000000,
/* 0x000006a4 */ 0x00000000,
/* 0x000006a8 */ 0x00000000,
/* 0x000006ac */ 0x00000000,
/* 0x000006b0 */ 0x00000000,
/* 0x000006b4 */ 0x00000000,
/* 0x000006b8 */ 0x00000000,
/* 0x000006bc */ 0x00000000,
/* 0x000006c0 */ 0x00000000,
/* 0x000006c4 */ 0x00000000,
/* 0x000006c8 */ 0x00000000,
/* 0x000006cc */ 0x00000000,
/* 0x000006d0 */ 0x00000000,
/* 0x000006d4 */ 0x00000000,
/* 0x000006d8 */ 0x00000000,
/* 0x000006dc */ 0x00000000,
/* 0x000006e0 */ 0x00000000,
/* 0x000006e4 */ 0x00000000,
/* 0x000006e8 */ 0x00000000,
/* 0x000006ec */ 0x00000000,
/* 0x000006f0 */ 0x00000000,
/* 0x000006f4 */ 0x00000000,
/* 0x000006f8 */ 0x00000000,
/* 0x000006fc */ 0x00000000,
/* 0x00000700 */ 0x00000000,
/* 0x00000704 */ 0x00000000,
/* 0x00000708 */ 0x00000000,
/* 0x0000070c */ 0x00000000,
/* 0x00000710 */ 0x00000000,
/* 0x00000714 */ 0x00000000,
/* 0x00000718 */ 0x00000000,
/* 0x0000071c */ 0x00000000,
/* 0x00000720 */ 0x00000000,
/* 0x00000724 */ 0x00000000,
/* 0x00000728 */ 0x00000000,
/* 0x0000072c */ 0x00000000,
/* 0x00000730 */ 0x00000000,
/* 0x00000734 */ 0x00000000,
/* 0x00000738 */ 0x00000000,
/* 0x0000073c */ 0x00000000,
/* 0x00000740 */ 0x00000000,
/* 0x00000744 */ 0x00000000,
/* 0x00000748 */ 0x00000000,
/* 0x0000074c */ 0x00000000,
/* 0x00000750 */ 0x00000000,
/* 0x00000754 */ 0x00000000,
/* 0x00000758 */ 0x00000000,
/* 0x0000075c */ 0x00000000,
/* 0x00000760 */ 0x00000000,
/* 0x00000764 */ 0x00000000,
/* 0x00000768 */ 0x00000000,
/* 0x0000076c */ 0x00000000,
/* 0x00000770 */ 0x00000000,
/* 0x00000774 */ 0x00000000,
/* 0x00000778 */ 0x00000000,
/* 0x0000077c */ 0x00000000,
/* 0x00000780 */ 0x00000000,
/* 0x00000784 */ 0x00000000,
/* 0x00000788 */ 0x00000000,
/* 0x0000078c */ 0x00000000,
/* 0x00000790 */ 0x00000000,
/* 0x00000794 */ 0x00000000,
/* 0x00000798 */ 0x00000000,
/* 0x0000079c */ 0x00000000,
/* 0x000007a0 */ 0x00000000,
/* 0x000007a4 */ 0x00000000,
/* 0x000007a8 */ 0x00000000,
/* 0x000007ac */ 0x00000000,
/* 0x000007b0 */ 0x00000000,
/* 0x000007b4 */ 0x00000000,
/* 0x000007b8 */ 0x00000000,
/* 0x000007bc */ 0x00000000,
/* 0x000007c0 */ 0x00000000,
/* 0x000007c4 */ 0x00000000,
/* 0x000007c8 */ 0x00000000,
/* 0x000007cc */ 0x00000000,
/* 0x000007d0 */ 0x00000000,
/* 0x000007d4 */ 0x00000000,
/* 0x000007d8 */ 0x00000000,
/* 0x000007dc */ 0x00000000,
/* 0x000007e0 */ 0x00000000,
/* 0x000007e4 */ 0x00000000,
/* 0x000007e8 */ 0x00000000,
/* 0x000007ec */ 0x00000000,
/* 0x000007f0 */ 0x00000000,
/* 0x000007f4 */ 0x00000000,
/* 0x000007f8 */ 0x00000000,
/* 0x000007fc */ 0x00000000
//*********** END CGRA MEM IMAGE DUMP ***********
};

bsg_remote_int_ptr xcel_CSR_base_ptr;

int __attribute__ ((noinline)) kernel_cgra_xcel(int *A, int *B, int *C, int N) {
  int i;
  volatile int *xcel_res_ptr;

  bsg_set_tile_x_y();

  xcel_CSR_base_ptr = bsg_global_ptr(XCEL_X_CORD, XCEL_Y_CORD, 0);

  if((__bsg_x == 0) && (__bsg_y == 0) && (N <= MAX_ARRAY_SIZE)) {
    bsg_printf("[INFO] cgra-xcel starts!\n");

    // Copy data from DRAM into scratchpad
    for(i = 0; i < N; i++) {
      scratchpad_A[i] = A[i];
      scratchpad_B[i] = B[i];
    }

    //==========================================================
    // Stage configuration and data into xcel scratchpad
    //==========================================================

    // Stage configuration

    for(i = CFG_IMAGE_START; i < CFG_IMAGE_END; i++)
      *(xcel_CSR_base_ptr + i*4) = vvadd2x2_cfg[i];

    // Stage data

    for(i = 0; i < MAX_ARRAY_SIZE; i++) {
      *(xcel_CSR_base_ptr + OP_A_START + i*4) = scratchpad_A[i];
      *(xcel_CSR_base_ptr + OP_B_START + i*4) = scratchpad_B[i];
    }

    bsg_printf("[INFO] Config and data have been staged into CGRA scratchpad!\n");

    // Set up the BASE_CFG_ADDR xcel register

    *(xcel_CSR_base_ptr + BASE_CFG_ADDR_ID) = BASE_CFG_ADDR;

    //==========================================================
    // Launch CGRA configuration and computation
    //==========================================================

    *(xcel_CSR_base_ptr + GO_CFG_ID) = 1;

    //==========================================================
    // Polling the status of the CGRA until it's done
    //==========================================================
    // TODO: this will generate tons of network traffic! the
    // CGRA should be able to signal the processor when it's
    // done...

    while(*(xcel_CSR_base_ptr + DONE_ID) == 0);

    bsg_printf("[INFO] CGRA has finished computation!\n");

    //==========================================================
    // Read back the results and write back to DRAM
    //==========================================================

    for(i = 0; i < MAX_ARRAY_SIZE; i++) {
      scratchpad_C[i] = *(xcel_CSR_base_ptr + RES_C_START + i*4);
      bsg_printf("[INFO] C[%d]=0x%x\n", i, scratchpad_C[i]);
    }

    // Copy result from scratchpad into DRAM

    for(i = 0; i < N; i++)
      C[i] = scratchpad_C[i];
  }
}
