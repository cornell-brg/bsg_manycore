/**
 *  main.c
 *
 *  quicksort
 */

#include "bsg_manycore.h"
#include "bsg_set_tile_x_y.h"

#define NUM_DATA 256

int data[NUM_DATA] __attribute__ ((section (".dram"))) = {
78113, 17198, 14782, 16082, 9277,  85314, 16469, 30084,
52569, 37570, 38166, 67932, 58458, 53102, 75867, 96332,
842,   70077, 62479, 39741, 89951, 35239, 66788, 82916,
37515, 2778,  57651, 22652, 18587, 70651, 70152, 25686,
30002, 89551, 15633, 87965, 88199, 76903, 64265, 84150,
39286, 46186, 39684, 45319, 79187, 24765, 87722, 28434,
22963, 29593, 45248, 58904, 74658, 85106, 69356, 81062,
95151, 14849, 71309, 91866, 27618, 92831, 70993, 82279,
69459, 49125, 65084, 56782, 13365, 52947, 29800, 36505,
44389, 15180, 7282,  8842,  28547, 16757, 88223, 55053,
78651, 11918, 48023, 56872, 65456, 79328, 22877, 77421,
66976, 95917, 76287, 63778, 42452, 34856, 96273, 66728,
27939, 82898, 23122, 33035, 40497, 99457, 10580, 96097,
77039, 18125, 48743, 81845, 19005, 67238, 273,   33233,
65641, 68438, 74165, 46283, 7831,  43678, 75323, 23181,
97566, 89398, 10363, 71153, 48189, 99549, 43076, 64207,
21768, 17813, 95298, 30769, 5252,  40953, 44843, 28675,
86053, 65200, 23326, 12098, 49032, 10877, 42054, 78334,
24958, 17408, 15892, 46539, 77529, 53855, 37170, 66949,
62694, 84726, 37608, 97063, 1273,  86878, 56877, 58631,
74808, 81716, 85051, 77593, 27137, 2514,  12958, 18107,
69421, 48515, 93339, 79173, 43744, 50788, 81895, 50167,
96780, 83471, 10890, 76593, 10634, 60349, 71441, 71063,
78443, 1260,  5639,  98513, 45697, 58424, 93919, 99756,
75990, 10075, 27239, 9225,  63233, 66448, 41648, 93934,
49807, 2790,  91247, 9263,  26127, 53064, 52455, 37274,
91995, 74436, 32544, 44229, 60084, 11431, 26025, 23566,
72647, 94843, 16033, 73780, 81815, 37831, 74525, 22679,
79412, 53942, 40179, 7432,  28444, 70789, 70390, 20765,
73822, 86329, 55946, 89120, 22523, 64467, 41163, 85592,
39180, 47204, 67812, 4571,  2676,  87981, 66139, 2665,
92952, 11268, 53841, 67890, 82685, 80028, 10386, 3746
};

int local_lst[NUM_DATA];

void quicksort(int* lst, int n)
{
  if (n == 1)
  {
    return;
  }

  int center = lst[0];
  int front = 0;
  int back = n-1;
  bsg_printf("starting front: %d, back: %d\n", front, back);

  for (int i = 1; i < n; i++)
  {
    int temp = lst[i];
    if (temp >= center)
    {
      local_lst[back] = temp;
      back--;
    }
    else
    {
      local_lst[front] = temp;
      front++;
    }
  } 

  if (back == front)
  {
    local_lst[back] = center; 

    for (int i = 0; i < n; i++) 
    {
      lst[i] = local_lst[i];
    }    
    if (front != 0)
    {
      quicksort(lst, front);
    }
    if (back != n-1)
    {
      quicksort(&(lst[back+1]), n-1-back);
    }
  }
  else
  {
    bsg_printf("front: %d, back: %d\n", front, back);
    bsg_fail_x(3);
  }
}

int main()
{
  bsg_set_tile_x_y();
  
  if (bsg_x == 0 && bsg_y == 0)
  {
    quicksort(data, NUM_DATA);

    for (int i = 0; i < NUM_DATA-1; i++)
    {
      if (data[i] > data[i+1])
      {
        bsg_fail_x(3);
      }
    }

    bsg_finish_x(3);
  }

  bsg_wait_while(1);
}
